# https协议及https模块

[toc]

## https协议

超文本安全传输协议 保证数据传输过程不被窃取和篡改

https传输非明文模式，能被窃取但无法被解析

### 加密

加密分文两种：对称加密和不对称加密

#### 对称加密

产生一个密钥，可以用其加密，也可用其解密

加密过程:

```text
信息 + key = (key(信息))
```

解密过程

```text
(key(信息)) + key = 信息
```

常用算法：`DES`, `3DES`, `AES`, `Blowfish`等

#### 非对称加密

非对称加密：产生一堆密钥，一个用于加密，一个用于解密

产生密钥对：公钥 + 私钥

加密过程： 信息 + 公钥  = （key(信息)）
解密过程：(key(信息)) + 私钥 = 信息

常用算法：`RSA`,`Elgamal`,`Rabin`,`D-H`,`ECC`等

### 对称加密+非对称加密模式

上面两种模式，对称加密可能会被截取密钥，非对称加密在客户端无法解密（私钥仅在客户端）
因此有两种混合：

1. 服务端生成密钥对，将公钥发给客户端(客户端得到公钥)
2. 客户端生成对称密钥key2，并用公钥加密传给服务端(服务端用私钥解密得到key2)
3. 服务端与客户端使用key2进行加密传输

#### 隐患

在将公钥发送至客户端过程中，可能被第三方获取并篡改：

1. 服务端生成密钥对，将`公钥`发往客户端(服务端：`公钥` + `私钥`)
2. 第三方截取`公钥`，并生成`自己的密钥对`，将`自己的公钥`发往客户端 （第三方：`公钥` `third-公钥` `third-私钥`）
3. 服务端收到`third-公钥`，以为是服务端发来的，生成对称密钥`key2`，将`key2`通过`third-公钥`加密发往服务端（客户端：`third-公钥` `key2`）
4. 第三方截取信息，通过`third-私钥`解密，获取到`key2`，==此时第三方获取到所有权限==，key2可发送给服务端，也可随意发送，加解密都能完成，交互内容也可随意更改(第三方：`公钥`,`third-公钥`,`third-私钥`,`key2`)

5. 客户端收到`key2`，开始传输内容(服务端:`公钥`, `私钥`，`key2`)

## 证书颁发机构CA

Certificate Authority

向CA申请证书，证书一般包含：

+ 域名
+ 证书颁发机构
+ (私钥(公钥))
+ (私钥(证书签名))

公钥、证书签名通过CA机构==私钥加密==，只能通过CA的公钥解密，但无法重新加密/伪造

### 证书签名 signature

证书签名算法是公开的，它出现的目的是为了让每一个拿到证书的终端，可以验证签名是否被篡改

`域名 + CA公钥 + 公钥key1 = 证书签名`

### 使用https后

1. 浏览器获取证书，根据证书 + 域名 + 证书机构 +证书签名 ,验证签名，保证服务端发来的公钥及证书没被篡改，同时得到 服务器发来的公钥，阻止了第三方的篡改

2. 后面的步骤和之前的方式一致，第三方可以获取到，但是缺少key2，无法解密，也无法篡改，最多只能进行拦截，但无法对服务器造成损失

### 协议

http 协议是建立在TCP/IP协议上
https 协议在与TCP/IP协议间加了一层SSL安全传输协议
